(venv) PS C:\Users\pc\Downloads\senioraaa-main> python -m flake8 . --exclude=venv,docs,tests,venv/Lib/site











                                                python -m flake8 . --exclude=venv,docs,tests,venv/Lib/site-packages
.\ai_code_genius.py:2:1: F401 'os' imported but unused
.\ai_code_genius.py:3:1: F401 're' imported but unused
.\ai_code_genius.py:35:80: E501 line too long (80 > 79 characters)
.\ai_code_genius.py:57:80: E501 line too long (85 > 79 characters)
.\ai_code_genius.py:114:80: E501 line too long (103 > 79 characters)
.\ai_code_genius.py:140:80: E501 line too long (95 > 79 characters)
.\ai_code_genius.py:187:80: E501 line too long (95 > 79 characters)
.\ai_code_genius.py:234:80: E501 line too long (81 > 79 characters)
.\ai_code_genius.py:236:80: E501 line too long (88 > 79 characters)
.\ai_code_genius.py:240:80: E501 line too long (89 > 79 characters)
.\ai_code_genius.py:243:80: E501 line too long (86 > 79 characters)
.\ai_code_genius.py:246:80: E501 line too long (84 > 79 characters)
.\ai_code_genius.py:251:80: E501 line too long (82 > 79 characters)
.\test_profile.py:34:80: E501 line too long (91 > 79 characters)
.\ultimate_auto_sync.py:54:1: E999 IndentationError: expected an indented block after 'try' statement on line 53
(venv) PS C:\Users\pc\Downloads\senioraaa-main> 
(venv) PS C:\Users\pc\Downloads\senioraaa-main>

#!/usr/bin/env python3
"""
Ø§Ù„Ø­Ù„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ ÙˆØ§Ù„Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø£Ø®Ø·Ø§Ø¡ flake8
ÙŠØµÙ„Ø­ ÙƒÙ„ Ø´ÙŠØ¡ ÙÙŠ Ø¯Ù‚Ø§Ø¦Ù‚!
"""

import os
import re
import subprocess
import sys
from pathlib import Path


class FlakeFixer:
    def __init__(self):
        self.fixed_files = []
        self.errors_fixed = 0

    def run_black_and_isort(self):
        """ØªØ´ØºÙŠÙ„ Black Ùˆ isort Ø£ÙˆÙ„Ø§Ù‹"""
        print("ðŸ”§ ØªØ´ØºÙŠÙ„ Black Ùˆ isort...")

        try:
            subprocess.run(
                [sys.executable, "-m", "black", "."],
                check=True,
                capture_output=True,
            )
            print("âœ… Black ØªÙ… Ø¨Ù†Ø¬Ø§Ø­")
        except:
            print("âŒ Black ÙØ´Ù„ - Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø¨Ø¯ÙˆÙ†Ù‡")

        try:
            subprocess.run(
                [sys.executable, "-m", "isort", "."],
                check=True,
                capture_output=True,
            )
            print("âœ… isort ØªÙ… Ø¨Ù†Ø¬Ø§Ø­")
        except:
            print("âŒ isort ÙØ´Ù„ - Ø§Ø³ØªÙƒÙ…Ø§Ù„ Ø¨Ø¯ÙˆÙ†Ù‡")

    def fix_app_py(self):
        """Ø¥ØµÙ„Ø§Ø­ Ø´Ø§Ù…Ù„ Ù„Ù…Ù„Ù app.py"""
        file_path = "app.py"
        if not os.path.exists(file_path):
            return

        print(f"ðŸ”§ Ø¥ØµÙ„Ø§Ø­ {file_path}...")

        with open(file_path, "r", encoding="utf-8") as f:
            content = f.read()

        original_content = content

        # 1. Ø­Ø°Ù imports ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø©
        imports_to_remove = [
            r"^from flask import.*g.*\n",
            r"^from models import.*AppSetting.*\n",
            r"^from werkzeug\.security import check_password_hash\n",
            r"^from werkzeug\.utils import secure_filename\n",
        ]

        for pattern in imports_to_remove:
            content = re.sub(pattern, "", content, flags=re.MULTILINE)

        # 2. Ø¥ØµÙ„Ø§Ø­ error_handler ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…
        content = re.sub(
            r"\s*error_handler = init_error_handlers\(app\)",
            "    init_error_handlers(app)",
            content,
        )

        # 3. Ø¥ØµÙ„Ø§Ø­ Ù…Ù‚Ø§Ø±Ù†Ø§Øª False
        content = content.replace(
            "if not user.is_verified == False:", "if user.is_verified:"
        )
        content = content.replace(
            "Message.is_deleted == False", "Message.is_deleted is False"
        )

        # 4. Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø®Ø·ÙˆØ· Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        long_lines_fixes = {
            # Flash messages
            r'flash\("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ\. ÙŠØ±Ø¬Ù‰ ÙØ­Øµ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙˆØ§Ø±Ø¯\."[^\n]*\)': 'flash(\n            "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¥Ù„Ù‰ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ. "\n            "ÙŠØ±Ø¬Ù‰ ÙØ­Øµ ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„ÙˆØ§Ø±Ø¯.", "info"\n        )',
            r'flash\("Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©\. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\."[^\n]*\)': 'flash(\n            "Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©. "\n            "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "error"\n        )',
            r'flash\("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©\. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰\."[^\n]*\)': 'flash(\n            "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©. "\n            "ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.", "error"\n        )',
        }

        for pattern, replacement in long_lines_fixes.items():
            content = re.sub(pattern, replacement, content)

        # 5. ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø·ÙˆÙŠÙ„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
        lines = content.split("\n")
        fixed_lines = []

        for line in lines:
            if len(line) > 79 and ('"' in line or "'" in line):
                # ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø·ÙˆÙŠÙ„Ø©
                if "flash(" in line and len(line) > 79:
                    # Ø¥ØµÙ„Ø§Ø­ Ø®Ø§Øµ Ù„Ù€ flash
                    indent = len(line) - len(line.lstrip())
                    if '"' in line:
                        parts = line.split('"')
                        if len(parts) >= 3:
                            fixed_line = f"{' ' * indent}flash(\n{' ' * (indent + 4)}\"{parts[1]}\",\n{' ' * (indent + 4)}\"{parts[3] if len(parts) > 3 else 'info'}\"\n{' ' * indent})"
                            fixed_lines.append(fixed_line)
                            continue
                elif (
                    "user.code_expiry = datetime.utcnow() + timedelta" in line
                ):
                    # Ø¥ØµÙ„Ø§Ø­ Ø®Ø§Øµ Ù„Ù„ØªØ§Ø±ÙŠØ®
                    indent = len(line) - len(line.lstrip())
                    fixed_lines.append(
                        f"{' ' * indent}user.code_expiry = (\n{' ' * (indent + 4)}datetime.utcnow() + timedelta(minutes=15)\n{' ' * indent})"
                    )
                    continue

            fixed_lines.append(line)

        content = "\n".join(fixed_lines)

        if content != original_content:
            with open(file_path, "w", encoding="utf-8") as f:
                f.write(content)
            self.fixed_files.append(file_path)
            print(f"âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ {file_path}")

    def fix_telegram_bot_py(self):
        """Ø¥ØµÙ„Ø§Ø­ Ù…Ù„Ù telegram_bot.py"""
        file_path = "telegram_bot.py"
        if not os.path.exists(file_path):
            return

        print(f"ðŸ”§ Ø¥ØµÙ„Ø§Ø­ {file_path}...")

        with open(file_path, "r", encoding="utf-8") as f:
            content = f.read()

        # Ø­Ø°Ù imports ØºÙŠØ± Ù…Ø³ØªØ®Ø¯Ù…Ø©
        imports_to_remove = [
            r"^import json\n",
            r"^import logging\n",
            r"^from flask import current_app\n",
        ]

        for pattern in imports_to_remove:
            content = re.sub(pattern, "", content, flags=re.MULTILINE)

        # Ø¥ØµÙ„Ø§Ø­ except Ø¹Ø§Ø±ÙŠØ©
        content = re.sub(r"except:\s*\n", "except Exception as e:\n", content)

        # Ø­Ø°Ù trailing whitespace
        content = re.sub(r"[ \t]+$", "", content, flags=re.MULTILINE)

        # ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø·ÙˆÙŠÙ„Ø©
        lines = content.split("\n")
        fixed_lines = []

        for line in lines:
            if len(line) > 79:
                # ØªÙ‚Ø³ÙŠÙ… Ø¨Ø³ÙŠØ· Ù„Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø·ÙˆÙŠÙ„Ø©
                if '"' in line and "=" in line:
                    parts = line.split("=", 1)
                    if len(parts) == 2:
                        indent = len(parts[0]) - len(parts[0].lstrip())
                        fixed_lines.append(f"{parts[0].rstrip()} = (")
                        fixed_lines.append(
                            f"{' ' * (indent + 4)}{parts[1].strip()}"
                        )
                        fixed_lines.append(f"{' ' * indent})")
                        continue

            fixed_lines.append(line)

        content = "\n".join(fixed_lines)

        with open(file_path, "w", encoding="utf-8") as f:
            f.write(content)
        self.fixed_files.append(file_path)
        print(f"âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ {file_path}")

    def fix_other_files(self):
        """Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø£Ø®Ø±Ù‰"""
        files_to_fix = {
            "analyze.py": {
                "remove_vars": ['command_target = "."'],
                "fix_lines": True,
            },
            "ultimate_auto_sync.py": {
                "remove_imports": [
                    "json",
                    "threading",
                    "pathlib.Path",
                    "psutil",
                ],
                "fix_except": True,
                "fix_lines": True,
            },
            "quick_start.py": {"remove_imports": ["os"], "fix_except": True},
            "service_runner.py": {"fix_except": True},
            "fix_flake8.py": {"remove_imports": ["os"]},
            "test_profile.py": {"fix_lines": True},
        }

        for filename, fixes in files_to_fix.items():
            if not os.path.exists(filename):
                continue

            print(f"ðŸ”§ Ø¥ØµÙ„Ø§Ø­ {filename}...")

            with open(filename, "r", encoding="utf-8") as f:
                content = f.read()

            original_content = content

            # Ø­Ø°Ù imports
            if "remove_imports" in fixes:
                for imp in fixes["remove_imports"]:
                    patterns = [f"^import {imp}\n", f"^from {imp} import.*\n"]
                    for pattern in patterns:
                        content = re.sub(
                            pattern, "", content, flags=re.MULTILINE
                        )

            # Ø­Ø°Ù Ù…ØªØºÙŠØ±Ø§Øª
            if "remove_vars" in fixes:
                for var in fixes["remove_vars"]:
                    content = re.sub(
                        f"^.*{re.escape(var)}.*\n",
                        "",
                        content,
                        flags=re.MULTILINE,
                    )

            # Ø¥ØµÙ„Ø§Ø­ except
            if fixes.get("fix_except"):
                content = re.sub(
                    r"except:\s*\n", "except Exception as e:\n", content
                )

            # Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø£Ø³Ø·Ø± Ø§Ù„Ø·ÙˆÙŠÙ„Ø©
            if fixes.get("fix_lines"):
                lines = content.split("\n")
                fixed_lines = []

                for line in lines:
                    if len(line) > 79:
                        # ØªÙ‚Ø³ÙŠÙ… Ø¨Ø³ÙŠØ·
                        if "=" in line and ('"' in line or "'" in line):
                            indent = len(line) - len(line.lstrip())
                            if indent < 60:  # ØªØ¬Ù†Ø¨ Ø§Ù„ØªØ¯Ø§Ø®Ù„ Ø§Ù„Ù…ÙØ±Ø·
                                parts = line.split("=", 1)
                                if len(parts) == 2:
                                    fixed_lines.append(
                                        f"{parts[0].rstrip()} = ("
                                    )
                                    fixed_lines.append(
                                        f"{' ' * (indent + 4)}{parts[1].strip()}"
                                    )
                                    fixed_lines.append(f"{' ' * indent})")
                                    continue

                    fixed_lines.append(line)

                content = "\n".join(fixed_lines)

            if content != original_content:
                with open(filename, "w", encoding="utf-8") as f:
                    f.write(content)
                self.fixed_files.append(filename)
                print(f"âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ {filename}")

    def check_flake8(self):
        """ÙØ­Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ flake8"""
        print("\nðŸ” ÙØ­Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ù…Ø¹ flake8...")

        try:
            result = subprocess.run(
                [
                    "python",
                    "-m",
                    "flake8",
                    ".",
                    "--exclude=venv,docs,tests,node_modules,dist",
                ],
                capture_output=True,
                text=True,
            )

            if result.stdout.strip():
                print("âš ï¸ Ù„Ø§ ØªØ²Ø§Ù„ Ù‡Ù†Ø§Ùƒ Ù…Ø´Ø§ÙƒÙ„:")
                print(result.stdout)
                return False
            else:
                print("âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø¬Ù…ÙŠØ¹ Ù…Ø´Ø§ÙƒÙ„ flake8!")
                return True

        except FileNotFoundError:
            print("âŒ flake8 ØºÙŠØ± Ù…Ø«Ø¨Øª")
            return False

    def run_fix(self):
        """ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙƒØ§Ù…Ù„"""
        print("ðŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ø´Ø§Ù…Ù„ Ù„Ø¬Ù…ÙŠØ¹ Ø£Ø®Ø·Ø§Ø¡ flake8...")
        print("=" * 60)

        # 1. ØªØ´ØºÙŠÙ„ Black Ùˆ isort
        self.run_black_and_isort()

        # 2. Ø¥ØµÙ„Ø§Ø­ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        self.fix_app_py()
        self.fix_telegram_bot_py()
        self.fix_other_files()

        # 3. ÙØ­Øµ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        success = self.check_flake8()

        # 4. ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        print("\n" + "=" * 60)
        print("ðŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¥ØµÙ„Ø§Ø­:")
        print(f"âœ… ØªÙ… Ø¥ØµÙ„Ø§Ø­ {len(self.fixed_files)} Ù…Ù„Ù")

        if self.fixed_files:
            print("ðŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…ÙØµÙ„Ø­Ø©:")
            for file in self.fixed_files:
                print(f"   - {file}")

        if success:
            print("\nðŸŽ‰ ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø¬Ù…ÙŠØ¹ Ù…Ø´Ø§ÙƒÙ„ flake8 Ø¨Ù†Ø¬Ø§Ø­!")
            print("\nðŸ“ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø§Ù„ØªØ§Ù„ÙŠØ©:")
            print("1. git add .")
            print("2. git commit -m 'Fix all flake8 issues'")
            print("3. git push origin main")
        else:
            print("\nâš ï¸ Ù‚Ø¯ ØªØ­ØªØ§Ø¬ Ù„Ø¥ØµÙ„Ø§Ø­Ø§Øª ÙŠØ¯ÙˆÙŠØ© Ø¥Ø¶Ø§ÙÙŠØ©")

        return success


if __name__ == "__main__":
    fixer = FlakeFixer()
    fixer.run_fix()
